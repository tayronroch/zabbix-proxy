zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: e3454865f3824ac3b20e5022cbdaf1e1
      name: 'CWS Templates'
  templates:
    - uuid: c65bbe648dce417ba0ae2e7691b0aa89
      template: 'CWS - HUAWEI - SFP'
      name: 'CWS - HUAWEI - SFP'
      description: 'CWS - HW - T09 - V4.0'
      groups:
        - name: 'CWS Templates'
      items:
        - uuid: dea74f423ae148048bdfc525968ca191
          name: 'Collect GBIC'
          type: EXTERNAL
          key: 'huawei_sw_sfp.py["collect", {HOST.CONN}, {$SSH_PORT}, {$SSH_USER}, {$SSH_PASS}, {HOST.NAME}]'
          delay: 30s
          history: 90d
          value_type: CHAR
          trends: '0'
          status: DISABLED
          tags:
            - tag: Application
              value: GBIC
        - uuid: 53b271eaddf644268a59c34408f95ed4
          name: 'Discovery GBIC'
          type: EXTERNAL
          key: 'huawei_sfp.py["launch_discovery", {HOST.CONN}, {$SSH_PORT}, {$SSH_USER}, {$SSH_PASS}, {HOST.NAME}]'
          delay: 3m
          history: 90d
          value_type: CHAR
          trends: '0'
          tags:
            - tag: Application
              value: GBIC
      discovery_rules:
        - uuid: e47eeaa6883e44bb93b85e673ac1ac07
          name: GBIC
          type: TRAP
          key: discovery_gbic
          delay: '0'
          lifetime: 3d
          enabled_lifetime_type: DISABLE_NEVER
          item_prototypes:
            - uuid: 64008c9a578249e184af56cbca7bcca3
              name: 'Corrente na Interface {#IFNAME} - {#IFALIAS} - {#GBIC_LANE}'
              type: TRAP
              key: 'curr[{#IFNAME},{#GBIC_LANE}]'
              delay: '0'
              value_type: FLOAT
              units: mA
              tags:
                - tag: Application
                  value: GBIC
            - uuid: 64f1637584834a4292148234c532009d
              name: 'Potência Recebida (RX) na Interface {#IFNAME} - {#IFALIAS} - {#GBIC_LANE}'
              type: TRAP
              key: 'rxpower[{#IFNAME},{#GBIC_LANE}]'
              delay: '0'
              value_type: FLOAT
              units: dBm
              tags:
                - tag: Application
                  value: GBIC
              trigger_prototypes:
                - uuid: 2de7de1250e246f9bb6b7b81214f1ad4
                  expression: '{#RX_THRESHOLD_HIGH}<>-0.01 and last(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}])>{#RX_THRESHOLD_HIGH} and {#RX_THRESHOLD_HIGH} <> -99.99'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}])<>0 and last(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}])<{#RX_THRESHOLD_HIGH}'
                  name: 'Potência Recebida (RX) Criticamente Alta na Interface {#IFNAME} - {#IFALIAS}{#GBIC_LANE} - Limiar: {#RX_THRESHOLD_HIGH} dBm'
                  priority: HIGH
                - uuid: 5bd05bab62394fc69482878ef78804bf
                  expression: '{#RX_THRESHOLD_LOW}<>-0.01 and last(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}])<{#RX_THRESHOLD_LOW} and {#RX_THRESHOLD_LOW} <> -99.99 and (last(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}],#1)<>last(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}],#2))<>0'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}])<>0 and last(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}])>{#RX_THRESHOLD_LOW}'
                  name: 'Potência Recebida (RX) Criticamente Baixa na Interface {#IFNAME} - {#IFALIAS}{#GBIC_LANE} - Limiar: {#RX_THRESHOLD_LOW} dBm'
                  priority: HIGH
                - uuid: 3c6dc3731a44484e81532532d2560eb6
                  expression: 'last(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}])<(avg(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}],{$DEF_MEDIA})-{$TRANCEIVER_RXPOWER_DROP})'
                  name: 'Queda de mais de {$TRANCEIVER_RXPOWER_DROP} dBm da Potência Recebida (RX) na Interface {#IFNAME} - {#IFALIAS}{#GBIC_LANE}'
                  priority: AVERAGE
                  dependencies:
                    - name: 'Potência Recebida (RX) Criticamente Baixa na Interface {#IFNAME} - {#IFALIAS}{#GBIC_LANE} - Limiar: {#RX_THRESHOLD_LOW} dBm'
                      expression: '{#RX_THRESHOLD_LOW}<>-0.01 and last(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}])<{#RX_THRESHOLD_LOW} and {#RX_THRESHOLD_LOW} <> -99.99 and (last(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}],#1)<>last(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}],#2))<>0'
                      recovery_expression: 'last(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}])<>0 and last(/CWS - HUAWEI - SFP/rxpower[{#IFNAME},{#GBIC_LANE}])>{#RX_THRESHOLD_LOW}'
            - uuid: e56646a1070c4d67a037736104635369
              name: 'Potência Transmitida (TX) na Interface {#IFNAME} - {#IFALIAS} - {#GBIC_LANE}'
              type: TRAP
              key: 'txpower[{#IFNAME},{#GBIC_LANE}]'
              delay: '0'
              value_type: FLOAT
              units: dBm
              tags:
                - tag: Application
                  value: GBIC
              trigger_prototypes:
                - uuid: d42a8ee5c8074316892f7dfd53a539e0
                  expression: '{#TX_THRESHOLD_HIGH}<>-0.01 and last(/CWS - HUAWEI - SFP/txpower[{#IFNAME},{#GBIC_LANE}])>{#TX_THRESHOLD_HIGH} and {#TX_THRESHOLD_HIGH} <> -99.99 and {#TX_THRESHOLD_HIGH} <> 99.9'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/CWS - HUAWEI - SFP/txpower[{#IFNAME},{#GBIC_LANE}])<>0 and last(/CWS - HUAWEI - SFP/txpower[{#IFNAME},{#GBIC_LANE}])<{#TX_THRESHOLD_HIGH}'
                  name: 'Potência Transmitida (TX) Criticamente Alta na Interface {#IFNAME} - {#IFALIAS}{#GBIC_LANE} - Limiar: {#TX_THRESHOLD_HIGH} dBm'
                  priority: HIGH
                - uuid: f1e14c98b61945e0b7e04f9003cdd3b0
                  expression: |
                    {#TX_THRESHOLD_LOW}<>-0.01 and 
                    last(/CWS - HUAWEI - SFP/txpower[{#IFNAME},{#GBIC_LANE}])<{#TX_THRESHOLD_LOW} and 
                    {#TX_THRESHOLD_LOW} <> -99.99 and
                    {#TX_THRESHOLD_LOW} <> 99.9 and
                    (last(/CWS - HUAWEI - SFP/txpower[{#IFNAME},{#GBIC_LANE}],#1)<>last(/CWS - HUAWEI - SFP/txpower[{#IFNAME},{#GBIC_LANE}],#2))<>0
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/CWS - HUAWEI - SFP/txpower[{#IFNAME},{#GBIC_LANE}])<>0 and last(/CWS - HUAWEI - SFP/txpower[{#IFNAME},{#GBIC_LANE}])>{#TX_THRESHOLD_LOW}'
                  name: 'Potência Transmitida (TX) Criticamente Baixa na Interface {#IFNAME} - {#IFALIAS}{#GBIC_LANE} - Limiar: {#TX_THRESHOLD_LOW} dBm'
                  priority: HIGH
        - uuid: a876b42189284947940309c4734a3655
          name: 'GBIC Temperatura e Tensão'
          type: TRAP
          key: discovery_gbic_temp_volt
          delay: '0'
          lifetime: 3d
          enabled_lifetime_type: DISABLE_NEVER
          item_prototypes:
            - uuid: 7f7078451d294790a7365b8e9bd8c198
              name: 'Temperatura na Interface {#IFNAME} - {#IFALIAS}'
              type: TRAP
              key: 'temp[{#IFNAME}]'
              delay: '0'
              value_type: FLOAT
              units: °C
              tags:
                - tag: Application
                  value: GBIC
            - uuid: dd4a7f84511743ed8efba75139050d09
              name: 'Tensão na Interface {#IFNAME} - {#IFALIAS}'
              type: TRAP
              key: 'volt[{#IFNAME}]'
              delay: '0'
              value_type: FLOAT
              units: V
              tags:
                - tag: Application
                  value: GBIC
      macros:
        - macro: '{$DEF_MEDIA}'
          value: 3h
        - macro: '{$SSH_PASS}'
        - macro: '{$SSH_PORT}'
        - macro: '{$SSH_USER}'
        - macro: '{$TRANCEIVER_RXPOWER_DROP}'
          value: '3'
